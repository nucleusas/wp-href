(()=>{"use strict";!function(e){var n=wpHreflangAdminSettings,t=!1,o=e("#wp-hreflang-settings-form"),s=e("#save-settings-button"),r=e("#wp-hreflang-settings-message"),a=e("#wp-hreflang-progress-modal"),i=e("#wp-hreflang-progress-title"),c=e("#wp-hreflang-progress-desc"),l=e("#wp-hreflang-site-progress-label"),p=e("#wp-hreflang-post-progress-label"),u=e("#wp-hreflang-current-site"),d=e("#wp-hreflang-total-sites"),h=e("#wp-hreflang-current-post"),v=e("#wp-hreflang-total-posts"),g=e("#wp-hreflang-site-progress"),f=e("#wp-hreflang-post-progress"),m=e("#wp-hreflang-start-button"),w=e("#wp-hreflang-cancel-button"),_=e("#wp-hreflang-close-button"),b=e("#add-locale"),x=e("#add-archive-page");function y(e,n){r.removeClass("notice-success notice-error notice-warning notice-info").addClass("notice-"+n).html("<p>"+e+"</p>").show(),setTimeout((function(){r.fadeOut()}),5e3)}function S(){var t=n.sites.map((function(e){return'<option value="'.concat(e.id,'">').concat(e.name,"</option>")})).join(""),o='\n            <div class="locale-row">\n                <select name="locales[site_id][]" class="site-select">\n                    <option value="">'.concat(n.i18n.select_site,"</option>\n                    ").concat(t,'\n                </select>\n                <input type="text" \n                    name="locales[locale][]" \n                    value="" \n                    class="locale-input" \n                    placeholder="').concat(n.i18n.locale_placeholder,'" />\n                <button type="button" class="remove-locale button">').concat(n.i18n.remove,"</button>\n            </div>\n        ");e("#wp-hreflang-locales").append(o)}function k(){var t='\n            <div class="archive-page-row">\n                <input type="text"\n                    name="archive_pages[name][]"\n                    class="archive-name-input"\n                    placeholder="'.concat(n.i18n.archive_name,'" />\n                <input type="text"\n                    name="archive_pages[id][]"\n                    class="archive-id-input"\n                    placeholder="').concat(n.i18n.archive_id,'" />\n                <button type="button" class="remove-archive button">').concat(n.i18n.remove,"</button>\n            </div>\n        ");e("#wp-hreflang-archive-pages").append(t)}function O(){e.ajax({url:n.api.root+"wp-hreflang/v1/rebuild/process",method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",n.api.nonce)},success:function(e){if(!e.success)return y(n.i18n.error+": "+e.message,"error"),void j();N(e.status),e.status.completed?j():setTimeout(O,100)},error:function(e){var t;console.error("Error processing batch:",e),y(n.i18n.error+": "+((null===(t=e.responseJSON)||void 0===t?void 0:t.message)||"Unknown error"),"error"),j()}})}function N(e){var n=e.current_site_index/e.total_sites*100;u.text(e.current_site_index),d.text(e.total_sites),g.css("width",n+"%");var t=0;e.total_posts>0&&(t=e.current_post_index/e.total_posts*100),h.text(e.current_post_index),v.text(e.total_posts),f.css("width",t+"%")}function j(){t=!1,m.hide(),w.hide(),_.show(),g.css("width","100%"),f.css("width","100%"),l.text(n.i18n.complete),p.text(n.i18n.complete)}e(document).ready((function(){o.on("submit",(function(r){r.preventDefault(),t||function(){t=!0,s.prop("disabled",!0).text(n.i18n.processing);var r=o.serializeArray(),u={locales:{site_id:[],locale:[]},post_types:[],archive_pages:{name:[],id:[]},nonce:n.nonce};e.each(r,(function(e,n){"ignore_query_params"===n.name?u[n.name]=!0:n.name.match(/^locales\[site_id\]/)?u.locales.site_id.push(n.value):n.name.match(/^locales\[locale\]/)?u.locales.locale.push(n.value):"post_types[]"===n.name?u.post_types.push(n.value):n.name.match(/^archive_pages\[name\]/)?u.archive_pages.name.push(n.value):n.name.match(/^archive_pages\[id\]/)&&u.archive_pages.id.push(n.value)})),e.ajax({url:n.api.root+"wp-hreflang/v1/update-settings",method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",n.api.nonce)},data:JSON.stringify(u),contentType:"application/json",success:function(e){y(n.i18n.success,"success"),i.text(n.i18n.rebuild_title),c.text(n.i18n.rebuild_desc),l.text(n.i18n.site_progress),p.text(n.i18n.post_progress),m.show(),_.hide(),a.show()},error:function(e){var t;console.error("Error saving settings:",e),y(n.i18n.error+": "+((null===(t=e.responseJSON)||void 0===t?void 0:t.message)||"Unknown error"),"error")},complete:function(){t=!1,s.prop("disabled",!1).text(n.i18n.save_settings)}})}()})),m.on("click",(function(){t=!0,m.prop("disabled",!0).text(n.i18n.processing),e.ajax({url:n.api.root+"wp-hreflang/v1/rebuild/start",method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",n.api.nonce)},success:function(e){if(!e.success)return y(n.i18n.error+": "+e.message,"error"),void a.hide();N(e.status),O()},error:function(e){var t;console.error("Error starting rebuild:",e),y(n.i18n.error+": "+((null===(t=e.responseJSON)||void 0===t?void 0:t.message)||"Unknown error"),"error"),a.hide()}})})),w.on("click",(function(){a.hide()})),_.on("click",(function(){a.hide()})),b.on("click",S),e(document).on("click",".remove-locale",(function(){e(this).closest(".locale-row").remove()})),x.on("click",k),e(document).on("click",".remove-archive",(function(){e(this).closest(".archive-page-row").remove()})),e(document).on("blur",".archive-name-input",(function(){var n=e(this).siblings(".archive-id-input");""===n.val()&&n.val(e(this).val().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))}))}))}(jQuery)})();